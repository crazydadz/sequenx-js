/*! sequenx-js-build - v1.0.0 - 2016-05-13 */var Sequenx;!function(a){var b=function(){function a(b){var c=this;this._completedSubject=new Rx.Subject,this._extensionCompletedSubject=new Rx.Subject,this._started=!1,this.name=b,"empty"!=b&&(this.id=a.nextId++,a.VERBOSE&&console.log("Lapse "+this.name+" ("+this.id+") STARTED"),this._refCountDisposable=new Rx.RefCountDisposable(Rx.Disposable.create(function(){a.VERBOSE&&console.log("Lapse "+c.name+" ("+c.id+") COMPLETED"),c._completedSubject.onCompleted(),c._extensionCompletedSubject.onCompleted(),c._disposables=null,c.dispose()})),null==this._disposables&&(this._disposables=new Rx.CompositeDisposable))}return Object.defineProperty(a.prototype,"completed",{get:function(){return this._completedSubject},set:function(a){},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"extensionCompleted",{get:function(){return this._extensionCompletedSubject},set:function(a){},enumerable:!0,configurable:!0}),a.prototype.extend=function(b,c){var d=this;if(a.VERBOSE&&console.log("Lapse "+this.name+" ("+this.id+") EXTENDED +++++ "+b),null!=this._refCountDisposable){this._refCountDisposable.isDisposed&&console.error("Extending disposed lapse: "+this.name+" ("+this.id+")");var e=this._refCountDisposable.getDisposable(),f=Rx.Disposable.create(function(){a.VERBOSE&&console.log("Lapse "+d.name+" ("+d.id+") RELEASED ----- "+b),d._extensionCompletedSubject.onNext(b),e.dispose()});return this._disposables.add(f),f}return Rx.Disposable.empty},a.prototype.start=function(){this._started=!0,this._refCountDisposable.dispose()},a.prototype.dispose=function(){return this._started?(null!=this._disposables&&(console.warn("Lapse "+this.name+" ("+this.id+") INTERRUPTED ----- "),this._disposables.dispose()),this._disposables=null,this._refCountDisposable=null,this._completedSubject.dispose(),void this._extensionCompletedSubject.dispose()):void console.error("Trying to dipose a Lapse not yet started!")},a.EMPTY=new a("empty"),a.VERBOSE=!1,a.nextId=1,a}();a.Lapse=b}(Sequenx||(Sequenx={}));var Sequenx;!function(a){var b=function(){function b(a,b){this._completedSubject=new Rx.Subject,this.name=a,this._lapse=b,this._items=new Array,this._disposable=this._lapse.extend("sequence-"+a),console.log("Create sequence "+a)}return Object.defineProperty(b.prototype,"completed",{get:function(){return this._completedSubject},set:function(a){},enumerable:!0,configurable:!0}),b.prototype.add=function(a,b,d){this._items.push(new c(a,b,d))},b.prototype.addParallel=function(b,d){var e=new a.Lapse("parallel:"+d),f=new a.Parallel(d,e);b(f);var g=new c(null,e.name,null);g.parallel=f,this._items.push(g)},b.prototype.start=function(){console.log("Starting sequence "+this.name),this._items.length>0?this.doItem(this._items.shift()):this.onSequenceComplete()},b.prototype.doItem=function(b){var c=this;console.log("Sequence doItem "+b.toString());var d;if(this instanceof a.Parallel){d=this._lapse,d.completed.subscribe(function(a){c._completedSubject.onNext(a)},null,function(){c.onSequenceComplete()}),b.action(d);for(var e=0;e<this._items.length;e++)this._items[e].action(d);d.start()}else null!=b.parallel?(b.parallel.completed.subscribe(function(){},null,function(){c._completedSubject.onNext(b.lapseDescription),c._items.length>0?c.doItem(c._items.shift()):c.onSequenceComplete()}),b.parallel.start(),b.parallel._lapse.start()):(d=new a.Lapse(b.lapseDescription),d.completed.subscribe(function(){},null,function(){c._completedSubject.onNext(b.lapseDescription),c._items.length>0?c.doItem(c._items.shift()):c.onSequenceComplete()}),b.action(d),d.start())},b.prototype.onSequenceComplete=function(){this._completedSubject.onCompleted(),this._disposable.dispose()},b.prototype.dispose=function(){},b}();a.Sequence=b;var c=function(){function a(a,b,c){this.timer=null,this.parallel=null,this.action=a,this.lapseDescription=b,this.timer=c}return a.prototype.toString=function(){return this.lapseDescription},a}()}(Sequenx||(Sequenx={}));var __extends=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},Sequenx;!function(a){var b=function(a){function b(){a.apply(this,arguments)}return __extends(b,a),b}(a.Sequence);a.Parallel=b}(Sequenx||(Sequenx={}));