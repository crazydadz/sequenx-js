/*! sequenx-js-build - v1.0.0 - 2016-09-16 */var __extends=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)},Sequenx;!function(a){var b=function(){function a(a,b){this.action=a,this.message=b}return a.prototype.start=function(a){this.action.length>0?this.action(a):(this.action(),a())},a.prototype.toString=function(){return this.message,(null!=this.action).toString()},a}();a.CallbackItem=b}(Sequenx||(Sequenx={}));var Sequenx;!function(a){var b=function(){function a(a,b){this.marker=a,this.message=b}return a.prototype.start=function(a){a()},a.prototype.toString=function(){return this.message,this.marker},a}();a.MarkItem=b}(Sequenx||(Sequenx={}));var Sequenx;!function(a){var b=function(){function b(b){this._pendingExecution=a.Disposable.empty,this._items=new Array,this._isStarted=!1,this._isDisposed=!1,this._isCompleted=!1,this._isExecuting=!1,b?"string"==typeof b?this._log=new a.Log(b):this._log=b:this._log=new a.Log("")}return Object.defineProperty(b.prototype,"name",{get:function(){return this._log.name},enumerable:!0,configurable:!0}),b.prototype.getChildLog=function(a){return this._log.getChild(a)},b.prototype.add=function(a){if(!a.start)return void this._log.error("Trying to add something other than Sequenx.Item, use do if you use a function(lapse)");if(this._isDisposed)throw new Error("Trying to add action to a disposed sequence.");this._items.push(a)},b.prototype.start=function(a){this._isStarted||this._isDisposed||(this._isStarted=!0,this._cbComplete=a,this.scheduleNext())},b.prototype.scheduleNext=function(){this._pendingExecution.dispose(),this.executeNext()},b.prototype.executeNext=function(){var a=this;if(!(this._isExecuting||this._isCompleted||this._isDisposed)){if(0===this._items.length)return void this.onLastItemCompleted();var b=this._items.shift();try{this._isExecuting=!0,b.start(function(){a._isExecuting=!1,a.scheduleNext()})}catch(c){throw this._isExecuting=!1,c}}},b.prototype.onLastItemCompleted=function(){this.onSequenceComplete()},b.prototype.dispose=function(){this._isDisposed||(this._isCompleted||this._log.warning("Cancelling ("+this._items.length+" items)"),this.onSequenceComplete())},b.prototype.onSequenceComplete=function(){this._isCompleted||(this._items.length=0,this._isCompleted=!0,this._isDisposed=!0,this._log.dispose(),this._cbComplete&&this._cbComplete())},b.prototype.doDispose=function(a,b){return this["do"](function(){return a.dispose()},b?b:"Dispose"),this},b.prototype["do"]=function(b,c){return this.add(new a.CallbackItem(b,c)),this},b.prototype.doWait=function(a,b){return this["do"](function(b){return setTimeout(b,a)},b?b:"Wait "+a/1e3+"s"),this},b.prototype.doWaitForDispose=function(b,c){var d=new a.Disposable;return this["do"](function(a){d.action=a},c?c:"WaitForDispose"),d},b.prototype.doMark=function(b){return this.add(new a.MarkItem(b)),this},b.prototype.doParallel=function(b,c){var d=new a.Parallel;return d.message=c?c:"Parallel",b(d),this.add(d),this},b.prototype.doSequence=function(a,c){c=c?c:"Sequence";var d=new b;return a(d),this.add(d),this},b.prototype.skipToMarker=function(b,c){void 0===c&&(c=!1),this.skipTo(function(c){return c instanceof a.MarkItem&&c.marker===b})},b.prototype.skipToEnd=function(){this.skip(function(a){return!0})},b.prototype.skip=function(a){for(;this._items.length>0&&a(this._items[0]);)this._items.splice(0,1)},b.prototype.skipTo=function(a){for(var b=-1,c=0;c<this._items.length;c++)if(a(this._items[c])){b=c;break}b!==-1&&(this._items=this._items.slice(b))},b}();a.Sequence=b}(Sequenx||(Sequenx={}));var Sequenx;!function(a){var b=function(a){function b(){a.call(this)}return __extends(b,a),b.prototype.scheduleNext=function(){var a=this,b=this._items.length;return b?(this._items.forEach(function(c){return c.start(function(){return--b<=0&&a._cbComplete&&a._cbComplete()})}),void(this._items=[])):this._cbComplete&&this._cbComplete()},b.prototype.skip=function(a){throw new Error("skip not implemented for Parallel")},b.prototype.skipTo=function(a){throw new Error("skipTo not implemented for Parallel")},b}(a.Sequence);a.Parallel=b}(Sequenx||(Sequenx={}));var Sequenx;!function(a){var b=function(){function a(a){this.action=a,this._isDisposed=!1}return a.create=function(b){return new a(b)},Object.defineProperty(a.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!0,configurable:!0}),a.prototype.dispose=function(){!this._isDisposed&&this.action&&this.action(),this._isDisposed=!0},a.empty=new a,a}();a.Disposable=b;var c=function(a){function c(b){var c=this;a.call(this,function(){return c._self.dispose()}),this.disposable=b,this._count=0,this._self=this.getDisposable()}return __extends(c,a),c.prototype.getDisposable=function(){var a=this;return this._count++,this.isDisposed?b.empty:b.create(function(){a._count--,a._count<=0&&a.disposable.dispose()})},c}(b);a.RefCountDisposable=c}(Sequenx||(Sequenx={}));var Sequenx;!function(a){var b=function(){function b(b){var c=this;b?"string"==typeof b?this._log=new a.Log(b):this._log=b:this._log=new a.Log(""),this._refCountDisposable=new a.RefCountDisposable(a.Disposable.create(function(){return c.lapseCompleted()}))}return Object.defineProperty(b.prototype,"name",{get:function(){return this._log.name},enumerable:!0,configurable:!0}),b.prototype.getChildLog=function(a){return this._log.getChild(a)},b.prototype.sustain=function(b){return this._isCompleted||this._isDisposed?a.Disposable.empty:(b&&a.Log.isEnabled&&this._log.info("Sustain "+b),this._refCountDisposable.getDisposable())},b.prototype.start=function(a){this._isStarted||this._isCompleted||this._isDisposed||(this._isStarted=!0,this._completed=a,this._refCountDisposable.dispose())},b.prototype.dispose=function(){this._isDisposed||(this._isCompleted||this._log.info("Cancelling"),this.lapseCompleted())},b.prototype.lapseCompleted=function(){this._isCompleted||(this._isCompleted=!0,this._isDisposed=!0,this._log.dispose(),this._completed&&this._completed())},b.prototype.sequence=function(b,c){var d=this.sustain(),e=c?c:"Sequence",f=this.getChildLog(e),g=new a.Sequence(f);return b(g),g.start(function(){return d.dispose()}),g},b.prototype.child=function(a,c){var d=this.sustain(),e=c?c:"Child",f=this.getChildLog(e),g=new b(f);a(g),g.start(function(){return d.dispose()})},b}();a.Lapse=b}(Sequenx||(Sequenx={}));var Sequenx;!function(a){a.Sequence.prototype.doLapse=function(b,c){void 0===c&&(c="Lapse");var d=new a.Lapse(this.getChildLog(c));return this["do"](function(a){b(d),d.start(a)}),this}}(Sequenx||(Sequenx={}));var Sequenx;!function(a){var b=function(){function a(b,c){this._parent=c,this._name=null!=b?b:"",this._id=a.s_nextId++,a.isEnabled&&console.log(this.fullName+a.StartSuffix)}return Object.defineProperty(a.prototype,"name",{get:function(){return this._name},set:function(a){},enumerable:!0,configurable:!0}),a.prototype.toString=function(){return this.fullName},a.prototype.dispose=function(){this._isDisposed||(a.isEnabled&&console.log(this.fullName+a.EndSuffix),this._isDisposed=!0)},a.prototype.getChild=function(b){return new a(b,this)},a.prototype.info=function(b){for(var c=[],d=1;d<arguments.length;d++)c[d-1]=arguments[d];a.isEnabled&&console.log(this.format(b,c))},a.prototype.warning=function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];console.warn(this.format(a,b))},a.prototype.error=function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];console.error(this.format(a,b))},Object.defineProperty(a.prototype,"fullName",{get:function(){return null==this._fullName&&(null!=this._parent?this._fullName=this._parent.fullName+a.PathSeparator+this.getNameWithId():this._fullName=this.getNameWithId()),this._fullName},enumerable:!0,configurable:!0}),a.prototype.getNameWithId=function(){return"("+this._id+") "+this._name},a.prototype.format=function(b,c){return b&&null!=c&&c.length>0&&(b=this.strFormat(b,c)),this.fullName+a.MessageSeparator+b},a.prototype.strFormat=function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];var d=b;return a.replace(/{(\d+)}/g,function(a,b){return"undefined"!=typeof d[b]?d[b]:a})},a.PathSeparator="     ",a.MessageSeparator="     ",a.StartSuffix=" [START]",a.EndSuffix=" [END]",a.s_nextId=1,a.isEnabled=!0,a}();a.Log=b}(Sequenx||(Sequenx={}));var Sequenx;!function(a){a.Sequence.prototype.doPromise=function(a){return a instanceof Promise?this["do"](function(b){return a.then(function(a){return b()})}):this["do"](function(b){return a().then(function(a){return b()})}),this},a.Sequence.prototype.startPromise=function(){var a=this;return new Promise(function(b){return a.start(b)})}}(Sequenx||(Sequenx={})),"undefined"!=typeof module&&module.exports&&(this.Rx=require("rx-lite"));var Sequenx;!function(a){a.Sequence.prototype.doWaitForCompleted=function(a,b){return this["do"](function(b){return a.subscribeOnCompleted(b)},b?b:"WaitForCompleted"),this},a.Sequence.prototype.doWaitForNext=function(a,b){return this["do"](function(b){return a.subscribeOnNext(b)},b?b:"WaitForNext"),this},a.Sequence.prototype.startRx=function(){var a=this;return Rx.Observable.create(function(b){return a.start(function(){return b.onCompleted()})})}}(Sequenx||(Sequenx={})),"undefined"!=typeof module&&module.exports&&(module.exports=Sequenx);