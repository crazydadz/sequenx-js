<!DOCTYPE html>
<html>
<head>
	<title>Sequenx-js -- Simple Lapse Example</title>
	<meta charset="UTF-8">

  <script src="../../js/rx.lite.min.js"></script>
	<script src="../../js/sequenx.js"></script>

<script>

function start() {

	var lapse = new Sequenx.Lapse('simple-lapse-sequence');
  var sequence = new Sequenx.Sequence('simple-sequence', lapse);

  var subscription = sequence.completed.subscribe(
    function (x) { console.warn('onNext: %s', x); },
    function (e) { console.log('onError: %s', e); },
    function () {
      console.log('Sequence %s completed!', sequence.name);
      sequence.dispose();
      complete();
    }
  );

	sequence.add(waitForOneSecond, 'waitForOneSecond1');
	sequence.add(waitForOneSecond, 'waitForOneSecond2');

	sequence.addParallel(function (p){
		p.add(createRandomDiv, 'parallel-createRandomDiv1');
		p.add(createRandomDiv, 'parallel-createRandomDiv2');
		p.add(createRandomDiv, 'parallel-createRandomDiv3');
		p.add(createRandomDiv, 'parallel-createRandomDiv4');
		p.add(createRandomDiv, 'parallel-createRandomDiv5');
	}, "simple-parallel");

	sequence.add(waitForOneSecond, 'waitForOneSecond3');
	sequence.add(createRandomDiv, 'createRandomDiv3');
	sequence.add(waitForOneSecond, 'waitForOneSecond4');
	sequence.add(createRandomDiv, 'createRandomDiv4');
	sequence.add(waitForOneSecond, 'waitForOneSecond5');
	sequence.add(createRandomDiv, 'createRandomDiv5');
	sequence.add(waitForOneSecond, 'waitForOneSecond6');
	sequence.add(createRandomDiv, 'createRandomDiv6');
	sequence.add(waitForOneSecond, 'waitForOneSecond7');
	sequence.add(createRandomDiv, 'createRandomDiv7');
	sequence.add(createRandomDiv, 'createRandomDiv8');

	sequence.start();
}

function waitForOneSecond(lapse)
{
	console.log('waitForOneSecond!', lapse.name);
	var disposable1 = lapse.extend('timer-1000');
  setTimeout(function(){ disposable1.dispose() }, 1000);
}

function createRandomDiv(lapse)
{
	console.log('createRandomDiv!', lapse.name);
	var disposable = lapse.extend('create-random-div');

	var div = document.createElement('div');
	div.style.position = "absolute";
	div.style.width = "50px";
	div.style.height = "50px";
	document.body.appendChild(div);
	var xy = getRandomPosition(div);
	div.style.top = xy[0] + 'px';
	div.style.left = xy[1] + 'px';
	div.style.backgroundColor = "#" + ((1 << 24) * Math.random() | 0).toString(16);


	disposable.dispose();
}

function getRandomPosition(element) {
	var x = window.innerHeight- 50;
	var y = window.innerWidth - 50;
	var randomX = Math.floor(Math.random()*x);
	var randomY = Math.floor(Math.random()*y);
	return [randomX,randomY];
}

function complete()
{
  console.log('Lapse is completed, now do stuffs');
  document.body.style.backgroundColor = '#000000';
}

start();

</script>
</head>
<body>

</body>

</html>
